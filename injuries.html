<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>AmCharts</title>
    
  </head>
  <body id="" onload="">
    <!-- Styles -->
    <style>
    #chartdiv {
      width: 100%;
      height: 500px;
    }							
    </style>

    <!-- Resources -->
    <script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
    <script src="https://www.amcharts.com/lib/3/serial.js"></script>
    <script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
    <link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
    <script src="https://www.amcharts.com/lib/3/themes/light.js"></script>

<!-- Chart code -->
<script>
    var service="https://servicesqa.arcgis.com/97KLIFOSt5CxbiRI/arcgis/rest/services/Crashes_in_the_District_of_Columbia/FeatureServer/0"
    var query = {
      "where": "PEDESTRIANSINVOLVED IS NOT NULL",
      "outFields": "*",
      "orderByFields": "EXTRACT(MONTH from REPORTDATE)",
      "groupByFieldsForStatistics": "EXTRACT(MONTH from REPORTDATE)",
      "outStatistics": "[{'statisticType':'sum','onStatisticField': 'MAJORINJURIES','outStatisticFieldName': 'MAJORINJURIES'},{'statisticType':'sum','onStatisticField': 'MINORINJURIES','outStatisticFieldName': 'MINORINJURIES'}]",
      "f":"json"
    }

function getAsUriParameters(data) {
   var url = '';
   for (var prop in data) {
      url += encodeURIComponent(prop) + '=' + 
          encodeURIComponent(data[prop]) + '&';
   }
   return url.substring(0, url.length - 1)
}


var url = service + "/query?" + getAsUriParameters(query);

var chartData1 = [];

fetch(url)
.then(function(response) {
  return response.json().then(function(json) { buildChart(json)});
})
.then(function(myBlob) {
  var objectURL = URL.createObjectURL(myBlob);
  myImage.src = objectURL;
});
 
function buildChart(json) {
  var features = json.features;
  for(var i=0; i < features.length; i++) {
    chartData1.push(features[i].attributes);
  }
  console.log(chartData1)
  var chart = AmCharts.makeChart( "chartdiv", {
    "type": "serial",
    "theme": "dark",
    "dataProvider": chartData1,
    "legend": {
           "horizontalGap": 10,
           "maxColumns": 1,
           "position": "right",
   		"useGraphSettings": true,
   		"markerSize": 10
       },    
    "valueAxes": [ {
      "gridColor": "#FFFFFF",
      "gridAlpha": 0.2,
      "dashLength": 0
    } ],
    "gridAboveGraphs": true,
    "startDuration": 0.3,
    "startEffect": "easeInSine",
    "graphs": [ {
      "title": "MINORINJURIES",
      "balloonText": "[[EXPR_1]]: <b>[[MINORINJURIES]]</b>",
      "labelText": "[[MINORINJURIES]]",
      "fillAlphas": 0.8,
      "lineAlpha": 0.2,
      "type": "column",
      "color": "#000000",
      "valueField": "MINORINJURIES"
    } ,{
      "title": "MAJORINJURIES",
      "balloonText": "[[EXPR_1]]: <b>[[MAJORINJURIES]]</b>",
      "labelText": "[[MAJORINJURIES]]",
      "fillAlphas": 0.8,
      "lineAlpha": 0.2,
      "type": "column",
      "color": "#000000",
      "valueField": "MAJORINJURIES"
    } ],
    "chartCursor": {
      "categoryBalloonEnabled": false,
      "cursorAlpha": 0,
      "zoomable": false
    },
    "categoryField": "EXPR_1",
    "categoryAxis": {
      "gridPosition": "start",
      "gridAlpha": 0,
      "tickPosition": "start",
      "tickLength": 20
    },
    "export": {
      "enabled": true
    }

  } );
}
</script>

<!-- HTML -->
<div id="chartdiv"></div>	
  </body>
</html>